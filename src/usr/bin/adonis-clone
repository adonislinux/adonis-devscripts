#!/bin/sh 
#
# Checks out a branch, tag, or trunk  of a loud package. By default the lprecise branch 
#
# For example:
#
# $ lco loud-utils
#

DEFAULT=main
PROP="clone_url"



help()
{
    echo "Thought you needed --help, huh?"
    echo "That's ok, we're here to help"
    echo 
    echo "Usage:"
    echo $0" package"
    echo 
    echo "List All Packages"
    echo $0" --list"
}

list()
{
    $PROP="name"
    val=`jsonval`
    for url  in $val ; do
    echo $url 
    done
}

jsonval() 
{
  echo `curl -s -X GET https://api.github.com/users/adonislinux/repos | grep $prop | awk  '{ sub(/\"'''$prop'''\": /, ""); print}'  | tr \", " "`
}

clone()
{
    exit 1
}


while [ $1 ]
do
    if [ "${1}" = "--help" ]; then
	help
	exit
    elif [ "${1}" = "-s" ]; then
	shift
	PROP="ssh_url"
    elif [ "${1}" = "--list" ]; then
	shift
	list
    else
	PKG=${1}
	echo "Selecting package: ${PKG}"
    fi
    shift
done

[ -z "${PKG}" ] && echo "No package selected: ${PKG}"&& help && exit 1

if [ -n "${BRANCH}" ]; then
    SVN="https://svn.lcsee.wvu.edu/loud/${PKG}/branches/${BRANCH}";
elif [ -n "${TAG}" ]; then
    SVN="https://svn.lcsee.wvu.edu/loud/${PKG}/tags/${TAG}";
elif [ -n "${TRUNK}" ]; then
    SVN="https://svn.lcsee.wvu.edu/loud/${PKG}/${TRUNK}";
else
    SVN="https://svn.lcsee.wvu.edu/loud/${PKG}/branches/${DEFAULT}";
fi

echo "Checking out from: ${SVN}"

mkdir -p ${PKG} && cd ${PKG} && svn checkout ${SVN} && cd ..


 
# # prop="ssh_url"
# # urls=`jsonval`
 
#  function list
# {
#     echo`curl -s -X GET https://api.github.com/users/adonislinux/repos | grep "\"name\":"  | awk  '{ sub(/\"name\": /, ""); print}' | tr \", " "`
# }

# function list-desc
# {
#     echo`curl -s -X GET https://api.github.com/users/adonislinux/repos | grep "\"description\":"  | awk  '{ sub(/\"description\": /, ""); print}'`
# }

# prop="\"name\":"
# #urls=`jsonval`                                                                                                                                                    
# IFS=","

# repodesc=(`list-desc`)
# #repos=`list`                                                                                                                                                      
# #echo $repos | sed s/,/\n/g                                                                                                                                        


# echo`${repodesc[0]} | tr "\"" "\000"`
# #for repod  in $repodesc ; do                                                                                                                                      
# #    echo $repod | tr "\"" "\000"                                                                                                                                  
#done                                                                                                                                                              

